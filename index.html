<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8">
<title>Sportles Observatie Timer v10</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body {
    font-family: Arial, sans-serif;
    background:#1e1e1e;
    color:#ddd;
    margin:0;
    padding:0;
    height:100vh;
    display:flex;
    flex-direction:column;
  }

  h1 {text-align:center; margin:15px 0; font-size:1.4em; color:#fff;}

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     STARTPANEEL
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #configPanel {
    background:#222;
    padding:20px;
    border-radius:12px;
    width:90%;
    max-width:600px;
    margin:20px auto;
    display:block;
  }

  #configPanel h2 {
    margin-top:0;
    font-size:1.3em;
    color:#fff;
  }

  #configPanel label {
    font-size:.95em;
    opacity:.8;
  }

  #configPanel input {
    width:100%;
    padding:10px;
    margin:6px 0 18px 0;
    border:1px solid #555;
    background:#111;
    color:white;
    border-radius:8px;
  }

  #configStartBtn {
    width:100%;
    padding:15px;
    font-size:1.2em;
    background:#4caf50;
    border:none;
    border-radius:10px;
    color:white;
    cursor:pointer;
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     MAIN LAYOUT
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  main {
    flex:1;
    overflow-y:auto;
    padding:10px;
    display:none;
  }

  aside {
    height:100%;
    overflow-y:auto;
    padding:10px;
  }

  @media(min-width:900px){
    body{ flex-direction:row; }
    main{ width:64%; }
    aside{ width:36%; padding-left:12px; }
  }

  #total {text-align:center; font-size:2.6em; margin:10px 0; font-weight:bold;}

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     TIMELINE + LESDEEL LABELS
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #timelineWrapper {margin:20px 0;}
  #timelineLabels {
    display:flex;
    height:22px;
    margin-bottom:4px;
    overflow:hidden;
    font-size:.88em;
  }

  .timelineLabel {
    background:rgba(255,255,255,.14);
    text-align:center;
    color:#fff;
    padding:2px 4px;
    border-radius:4px;
    white-space:nowrap;
    overflow:hidden;
  }

  #timeline {
    height:20px;
    border-radius:10px;
    overflow:hidden;
    background:#222;
    display:flex;
  }

  .seg {
    height:100%;
    transition:width .25s linear;
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     CATEGORIE-KNOPPEN
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .cat {
    position:relative;
    padding:18px 16px 24px 16px;
    margin:12px 0;
    border-radius:14px;
    cursor:pointer;
    background:#333;
  }
  .cat.active {
    transform:scale(1.03);
    box-shadow:0 0 20px rgba(0,0,0,.7);
  }

  .fill {
    position:absolute;
    inset:0;
    width:0%;
    opacity:.45;
    transition:width .25s linear;
  }

  .label {
    font-size:1.3em;
    font-weight:bold;
    position:relative;
    z-index:2;
    margin-bottom:4px;
  }

  .desc {
    font-size:.95em;
    opacity:.85;
    position:relative;
    z-index:2;
  }

  .time {
    position:absolute;
    right:16px;
    bottom:14px;
    font-size:2em;
    font-weight:bold;
    z-index:2;
  }

  .perc {
    position:absolute;
    left:16px;
    top:10px;
    font-size:1em;
    font-weight:bold;
    padding:3px 9px;
    background:rgba(0,0,0,.65);
    border-radius:6px;
    z-index:3;
  }

  .controls {display:flex; gap:10px; margin:15px 0; flex-wrap:wrap;}
  button {flex:1; padding:15px; font-size:1.15em; border:none; border-radius:10px;}

  #startBtn {background:#4caf50; color:white; font-size:1.5em;}
  #pauseBtn {background:#ff9800; color:black;}
  #stopBtn  {background:#66bb6a; color:white;}
  #resetBtn {background:#d32f2f; color:white;}

  #noteInput {
    width:100%; padding:12px; margin:10px 0;
    background:#222; border:1px solid #444; border-radius:8px; color:white;
  }

  #noteBtn {background:#555; color:white; width:100%;}

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     LOG STRUCTUUR
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #log {
    background:#111;
    padding:12px;
    font-family:monospace;
    border-radius:10px;
    font-size:.98em;
  }

  .logL1 {
    font-weight:bold;
    color:#fff;
    margin-top:12px;
    padding:4px 0;
  }

  .logL2 {
    padding-left:20px;
    color:#ddd;
    margin:3px 0;
  }

  .logL3 {
    padding-left:40px;
    color:#ccc;
    margin:2px 0;
  }

  /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     EXPORT
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #exportSection {
    display:none;
    margin-top:20px;
  }

  #copyBtn, #downloadBtn {
    padding:12px;
    background:#444;
    border:none;
    border-radius:8px;
    color:white;
    cursor:pointer;
    width:48%;
  }

</style>
</head>
<body>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     STARTPANEEL (voor invullen van lesgegevens)
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="configPanel">
  <h2>Lesgegevens invullen</h2>

  <label>Titel van de les:</label>
  <input id="cfgTitle" type="text" placeholder="bv. Balvaardigheid â€“ tikspelen">

  <label>Lesgever(s):</label>
  <input id="cfgTeacher" type="text" placeholder="bv. Juf Sarah, Meester Tom">

  <label>Locatie / Klasgroep:</label>
  <input id="cfgLocation" type="text" placeholder="bv. 6SPORT â€“ Sporthal Rembert">

  <button id="configStartBtn">Observatie starten</button>
</div>



<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     MAIN OBSERVATIE-GEDEELTE
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<main>

  <h1 id="lessonHeader"></h1>

  <div id="total">00:00</div>

  <!-- TIMELINE + LESDEEL LABELS -->
  <div id="timelineWrapper">
    <div id="timelineLabels"></div>
    <div id="timeline"></div>
  </div>

  <!-- CATEGORIE KNOPPEN -->
  <div class="cat active" data-id="0">
    <div class="fill" style="background:#e65100"></div>
    <div class="perc" id="p0">0%</div>
    <div class="label">Organisatie & beheer</div>
    <div class="desc">materiaal klaarzetten, wachten, orde herstellenâ€¦</div>
    <div class="time" id="t0">0:00</div>
  </div>

  <div class="cat" data-id="1">
    <div class="fill" style="background:#7e57c2"></div>
    <div class="perc" id="p1">0%</div>
    <div class="label">Instructie & uitleg</div>
    <div class="desc">leerkracht praat, leerlingen luisterenâ€¦</div>
    <div class="time" id="t1">0:00</div>
  </div>

  <div class="cat" data-id="2">
    <div class="fill" style="background:#43a047"></div>
    <div class="perc" id="p2">0%</div>
    <div class="label">Actieve leertijd</div>
    <div class="desc">leerlingen motorisch bezig met de leerinhoudâ€¦</div>
    <div class="time" id="t2">0:00</div>
  </div>

  <div class="cat" data-id="3">
    <div class="fill" style="background:#616161"></div>
    <div class="perc" id="p3">0%</div>
    <div class="label">Overig / pauze</div>
    <div class="desc">onderbreking, blessure, drinkenâ€¦</div>
    <div class="time" id="t3">0:00</div>
  </div>


  <!-- TIMER CONTROLS -->
  <div class="controls">
    <button id="startBtn" class="hidden">Start observatie</button>
    <button id="pauseBtn" class="hidden">Pauze</button>
    <button id="stopBtn"  class="hidden">Stop & resultaten</button>
    <button id="resetBtn" class="hidden">Reset</button>
  </div>


  <!-- NOTITIES -->
  <input id="noteInput" class="hidden" type="text" placeholder="Opmerking typenâ€¦">
  <button id="noteBtn" class="hidden">Notitie toevoegen</button>


  <!-- EXPORT & RESULTAAT -->
  <div id="exportSection">
    <div style="display:flex; gap:12px;">
      <button id="copyBtn">ğŸ“‹ Kopieer logboek</button>
      <button id="downloadBtn">â¬‡ï¸ Download TXT</button>
    </div>
  </div>

</main>



<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     LOGBOEK
     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<aside>
  <h3>Logboek</h3>
  <div id="log"></div>
</aside>
<script>
/* ============================================================
   V10 SCRIPT â€“ DEEL 1
   Basale variabelen, helpers, config, segment-engine, lesdelen
   ============================================================ */

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   LESGEGEVENS (ingevuld in het startpaneel)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let lessonTitle = "";
let lessonTeacher = "";
let lessonLocation = "";

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TIJD & TIMING
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let running = false;
let startTime = null;
let lastTick  = null;
let totalElapsed = 0;

const accum = [0,0,0,0];           // tijd per categorie
let activeCat = 0;                 // actieve categorie
let noteTypingStart = null;        // absolute timestamp (Date.now())

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   CATEGORIE DATA
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const categories = [
  "Organisatie & beheer",
  "Instructie & uitleg",
  "Actieve leertijd",
  "Overig / pauze"
];

const colors = [
  "#ff9800", "#b39ddb", "#66bb6a", "#9e9e9e"
];

const fillColors = [
  "#e65100", "#7e57c2", "#43a047", "#616161"
];

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   LESSENDELEN (structuur van de les)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Regels:
   - Een nieuw lesdeel start *automatisch* bij categorie 1 (Instructie)
   - Elk lesdeel krijgt een segmentEntry in een array:
        { start:ms, label:"", segments:[...] }
   - segmenten voor timeline:
        { cat:i, start:ms, end:ms? }
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

let lessonParts = [];      // lijst met lesdelen
let currentPart = null;    // actief lesdeel (object)
let timelineSegments = []; // tijdsverloop segmenten

/* ============================================================
   HULPFUNCTIES
   ============================================================ */

function fmt(ms){
  const s = Math.floor(ms/1000);
  const m = Math.floor(s/60);
  const sec = String(s%60).padStart(2,"0");
  if(m >= 60){
    return `${Math.floor(m/60)}:${String(m%60).padStart(2,"0")}:${sec}`;
  }
  return `${m}:${sec}`;
}

function nowTs(){ return Date.now(); }

/* ============================================================
   LOGGING MET HIERARCHIE
   ============================================================ */

function logL1(text, tOverride=null){
  const t = (tOverride!==null ? fmt(tOverride) : fmt(totalElapsed));
  const div = document.createElement("div");
  div.className = "logL1";
  div.textContent = `[${t}] ${text}`;
  log.appendChild(div);
  div.scrollIntoView({behavior:"smooth"});
}

function logL2(text, tOverride=null){
  const t = (tOverride!==null ? fmt(tOverride) : fmt(totalElapsed));
  const div = document.createElement("div");
  div.className = "logL2";
  div.textContent = `[${t}] â†’ ${text}`;
  log.appendChild(div);
  div.scrollIntoView({behavior:"smooth"});
}

function logL3(text, tOverride=null){
  const t = (tOverride!==null ? fmt(tOverride) : fmt(totalElapsed));
  const div = document.createElement("div");
  div.className = "logL3";
  div.textContent = `[${t}] â†’ ${text}`;
  log.appendChild(div);
  div.scrollIntoView({behavior:"smooth"});
}

/* ============================================================
   START VAN DE OBSERVATIE
   ============================================================ */

configStartBtn.onclick = () => {
  lessonTitle   = cfgTitle.value.trim();
  lessonTeacher = cfgTeacher.value.trim();
  lessonLocation= cfgLocation.value.trim();

  if(lessonTitle===""){ alert("Geef een titel in."); return; }
  if(lessonTeacher===""){ alert("Geef de lesgever(s) in."); return; }

  configPanel.style.display="none";
  main.style.display="block";

  lessonHeader.textContent =
    `${lessonTitle} â€“ ${lessonTeacher}` +
    (lessonLocation ? ` (${lessonLocation})` : "");

  startBtn.classList.remove("hidden");
};

/* ============================================================
   START KNOP
   ============================================================ */

startBtn.onclick = () => {
  running = true;
  startTime = lastTick = nowTs();
  totalElapsed = 0;

  startBtn.classList.add("hidden");
  pauseBtn.classList.remove("hidden");
  stopBtn.classList.remove("hidden");
  resetBtn.classList.remove("hidden");
  noteInput.classList.remove("hidden");
  noteBtn.classList.remove("hidden");

  /* Eerste segment aanmaken */
  timelineSegments = [];
  timelineSegments.push({
    cat: activeCat,
    start: 0,
    end: null
  });

  /* Eerste log */
  logL1("OBSERVATIE GESTART");

  logL2(`Categorie: ${categories[activeCat]} (0:00)`);

  /* Eerste lesdeel? Nee: lesdeel start pas bij Instructie */
};

/* ============================================================
   UPDATE TICK
   ============================================================ */

function tick(){
  if(!running) return;

  const now = nowTs();
  const elapsed = now - lastTick;
  lastTick = now;

  accum[activeCat] += elapsed;
  totalElapsed     += elapsed;

  total.textContent = fmt(totalElapsed);

  /* Update categorie-knoppen UI */
  accum.forEach((ms,i)=>{
    document.querySelector("#t"+i).textContent = fmt(ms);
    const p = totalElapsed? (ms/totalElapsed*100).toFixed(1) : 0;
    document.querySelector("#p"+i).textContent = p+"%";
    document.querySelectorAll(".fill")[i].style.width = p+"%";
  });

  updateTimeline();       // live groei
  updateTimelineLabels(); // lesdelen-balk
}

setInterval(tick, 200);

/* ============================================================
   CATEGORIE-WISSEL
   ============================================================ */

document.querySelectorAll(".cat").forEach(catDiv => {
  catDiv.addEventListener("click", () => {
    if(!running) return;

    const newCat = Number(catDiv.dataset.id);
    if(newCat === activeCat) return;

    /* ---- segment afsluiten ---- */
    const lastSeg = timelineSegments[timelineSegments.length-1];
    lastSeg.end = totalElapsed;

    const segDur = lastSeg.end - lastSeg.start;

    /* ---- logging categorie-wissel ---- */
    logL2(`${categories[newCat]} (${fmt(segDur)})`);

    /* ---- nieuw segment starten ---- */
    timelineSegments.push({
      cat: newCat,
      start: totalElapsed,
      end: null
    });

    /* ---- lesdeel-engine ---- */
    if(newCat === 1){   // instructie = nieuw lesdeel
      currentPart = {
        start: totalElapsed,
        label: "",
        end: null
      };
      lessonParts.push(currentPart);
      logL1("NIEUW LESDEEL");
    }

    /* ---- UI wisselen ---- */
    document.querySelectorAll(".cat").forEach(c=>c.classList.remove("active"));
    catDiv.classList.add("active");

    activeCat = newCat;
    lastTick = nowTs();
  });
});

/* ============================================================
   NOTITIES
   ============================================================ */

noteInput.addEventListener("input", () => {
  if(noteInput.value.trim().length>0 && !noteTypingStart && running){
    noteTypingStart = nowTs();
  }
});

noteBtn.onclick = () => {
  const text = noteInput.value.trim();
  if(!text) return;

  const t = noteTypingStart ? (noteTypingStart - startTime) : totalElapsed;
  logL3(text, t);

  noteTypingStart = null;
  noteInput.value = "";
};

/* ============================================================
   DIT WAS DEEL 1 VAN HET SCRIPT
   DEEL 2 KOMT STRAKS: timeline-rendering, export, stop/reset
   ============================================================ */
</script>
<script>
/* ============================================================
   V10 SCRIPT â€“ DEEL 2
   Timeline-rendering, lesdeel-labels, export, stop/reset
   ============================================================ */


/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   TIMELINE RENDERING (segmenten naast elkaar)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updateTimeline(){
  timeline.innerHTML = "";

  const total = totalElapsed > 0 ? totalElapsed : 1;

  timelineSegments.forEach(seg => {
    const end = seg.end === null ? totalElapsed : seg.end;
    const width = ((end - seg.start) / total) * 100;

    const d = document.createElement("div");
    d.className = "seg";
    d.style.width = width + "%";
    d.style.background = colors[seg.cat];

    timeline.appendChild(d);
  });
}


/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   LESDEEL LABEL RENDERING (exact boven segment)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updateTimelineLabels(){
  timelineLabels.innerHTML = "";

  const total = totalElapsed > 0 ? totalElapsed : 1;

  lessonParts.forEach(part => {
    const pEnd = part.end !== null ? part.end : totalElapsed;
    const width = ((pEnd - part.start) / total) * 100;

    const lbl = document.createElement("div");
    lbl.className = "timelineLabel";
    lbl.style.width = width + "%";
    lbl.textContent = part.label ? part.label.toUpperCase() : "LESDEEL";
    timelineLabels.appendChild(lbl);
  });
}


/* ============================================================
   STOP FUNCTIE
   ============================================================ */

stopBtn.onclick = () => {
  if(running){
    tick();
    running = false;
  }

  /* laatste segment afsluiten */
  const lastSeg = timelineSegments[timelineSegments.length-1];
  lastSeg.end = totalElapsed;

  /* laatste lesdeel afsluiten */
  if(currentPart){
    currentPart.end = totalElapsed;
  }

  logL1("OBSERVATIE BEÃ‹INDIGD");

  /* Exports tonen */
  exportSection.style.display = "block";
};


/* ============================================================
   EXPORT â€” KLEMBOARD
   ============================================================ */

copyBtn.onclick = () => {
  const txt = generateExportText();
  navigator.clipboard.writeText(txt)
    .then(() => alert("Logboek gekopieerd naar klembord!"))
    .catch(() => alert("KopiÃ«ren mislukt."));
};


/* ============================================================
   EXPORT â€” DOWNLOAD TXT
   ============================================================ */

downloadBtn.onclick = () => {
  const txt = generateExportText();

  const blob = new Blob([txt], {type:"text/plain"});
  const url  = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;

  const safeTitle = lessonTitle.replace(/[^a-z0-9]/gi, "_").toLowerCase();
  a.download = `observatie_${safeTitle}.txt`;

  a.click();
  URL.revokeObjectURL(url);
};


/* ============================================================
   EXPORT TEXT GENERATOR
   ============================================================ */

function generateExportText(){
  let out = "";

  out += `LES: ${lessonTitle}\n`;
  out += `LESGEVER(S): ${lessonTeacher}\n`;
  if(lessonLocation) out += `LOCATIE / KLASGROEP: ${lessonLocation}\n`;
  out += `\nTOTALE LESDUUR: ${fmt(totalElapsed)}\n\n`;

  out += `--- VERDELING PER CATEGORIE ---\n`;
  categories.forEach((c,i)=>{
    const p = totalElapsed ? (accum[i]/totalElapsed*100).toFixed(1) : 0;
    out += `${c}: ${fmt(accum[i])} (${p}%)\n`;
  });

  out += `\n--- LESDELEN ---\n`;
  lessonParts.forEach(p=>{
    const end = p.end !== null ? p.end : totalElapsed;
    const name = p.label ? p.label.toUpperCase() : "LESDEEL";
    out += `${name}: ${fmt(end - p.start)}\n`;
  });

  out += `\n--- VOLLEDIG LOGBOEK ---\n`;

  document.querySelectorAll("#log div").forEach(div=>{
    out += div.textContent + "\n";
  });

  return out;
}


/* ============================================================
   RESET
   ============================================================ */

resetBtn.onclick = () => {
  if(confirm("Alles wissen en opnieuw beginnen?")){
    location.reload();
  }
};


/* ============================================================
   EINDE SCRIPT DEEL 2
   ============================================================ */

</script>

</body>
</html>

